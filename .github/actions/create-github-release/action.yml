name: Create GitHub Release
description: Create a GitHub Release with auto-generated changelog

inputs:
  tag:
    description: 'Git tag for the release'
    required: true
  github-token:
    description: 'GitHub token for creating release'
    required: true
  is-prerelease:
    description: 'Mark as pre-release'
    required: false
    default: 'false'

runs:
  using: 'composite'
  steps:
    - name: Detect pre-release from tag
      id: detect-prerelease
      shell: bash
      run: |
        TAG="${{ inputs.tag }}"
        if [[ "$TAG" == *"-rc"* ]] || [[ "$TAG" == *"-alpha"* ]] || [[ "$TAG" == *"-beta"* ]]; then
          echo "prerelease=true" >> $GITHUB_OUTPUT
        else
          echo "prerelease=${{ inputs.is-prerelease }}" >> $GITHUB_OUTPUT
        fi

    - name: Create GitHub Release
      shell: bash
      run: |
        PRERELEASE_FLAG=""
        if [[ "${{ steps.detect-prerelease.outputs.prerelease }}" == "true" ]]; then
          PRERELEASE_FLAG="--prerelease"
        fi

        gh release create "${{ inputs.tag }}" \
          --title "Release ${{ inputs.tag }}" \
          --generate-notes \
          $PRERELEASE_FLAG
      env:
        GITHUB_TOKEN: ${{ inputs.github-token }}
